- content_for :data_crumb do
  %ol.breadcrumb
    %li= link_to 'Home', '/'
    %li= link_to 'Statistics Selector', '#'

- page_title "Statistics Selector: Add column data"


%section#stats-selector.step-three
  .row.container
    .sixteen.columns
      %h3 Statistics Selector
      %h1 Step 3 of 3: Add column data

      %section#preview
        %header PREVIEW
        %table
          %thead
            - @selector.header_rows.each_with_index do |header_row, index|
              %tr
                %td
                - header_row.each do |header_column|
                  %th.hardwrap{ colspan: header_column.number_of_encompassed_dimension_values }= header_column.label
          %tbody
            - @selector.table_rows.each_with_index do |row, index|
              %tr
                %th= row.label
                - row.values(@observation_source).each do |value|
                  %td= value
                - if @selector.fragments.empty? && index == 0
                  %td.intro{rowspan: "#{ @selector.table_rows.size + 1 }"}
                    %p Get started! Add some column data from a dataset by clicking on 'Add Data' below.
        .foot &hellip;
      .actions
        = link_to datasets_selector_fragments_path(@selector), 'class' => 'btn btn-add-data', 'data-toggle' => 'modal', 'data-target' => '#add-data-modal' do
          %i.icon-circled-plus
          Add Data
        = link_to download_selector_path(@selector), class: 'btn primary' do
          %i.icon-download
          Download

#add-data-modal(style="display: none;")
  

#add-data-spinner.modal-dialog
  .modal-content
    .modal-body
      %em Loading Datasets

:javascript
  var spinner = $('#add-data-spinner').detach();

  $('#add-data-modal').on('hidden.bs.modal', function() {
    $(this).removeData();
    $('#add-data-modal').empty();
  });

  $('#add-data-modal').on('show.bs.modal', function() {
    $('#add-data-modal').append(spinner);
    console.log('show');
  });

  $('#add-data-modal').on('pmd.modal.loaded', function() {
    spinner.remove();
    console.log('shown');
  });